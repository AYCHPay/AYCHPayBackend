<style>
</style>
<script language="JavaScript" type="text/javascript">
	function SendTxOK{{.Unique}}() {
	}
	var serverTime{{.Unique}};
	var predata{{.Unique}};
	$(document).ready(function(){
	$('#send{{.Unique}}').bind('click', function () {
        do_generate();
        var key = $("#pubkey").val();
        if (key.length > 128) {
			key = key.substr( 2 );
		}
		predata{{.Unique}} = {
			'TxName' : 'GenCitizen',
        	'Name': $("#name").val(),
	        'PublicKey': key
		};

		$.get( 'ajax?json=ajax_prepare_tx', predata{{.Unique}},
			 function (data) {
				if (data.error.length > 0 ) {
					Alert("Error", data.error, "error");
				} else {
					console.log(data);
					predata{{.Unique}}.time = data.time;
					$("#for-signature{{.Unique}}").val(data.forsign);
					doSign({{.Unique}});
					predata{{.Unique}}.signature1 = $('#signature1{{.Unique}}').val();
					predata{{.Unique}}.signature2 = $('#signature2{{.Unique}}').val();
					predata{{.Unique}}.signature3 = $('#signature3{{.Unique}}').val();
//					$("#send_to_net{{.Unique}}").trigger("click");
					sendnet{{.Unique}}();
				}
		}, "json" );
	} );

function sendnet{{.Unique}}() {
  	predata{{.Unique}}['public'] = GKey.Public;
	$.ajax({
		type: 'POST',
		url: 'ajax?json=ajax_send_tx',
		data: predata{{.Unique}},
		dataType: 'json',
		crossDomain: true,
		success: function(result) {
			send_to_net_success(result, SendTxOK{{.Unique}});
		},
		error: function(xhr, status, error) {
			Alert("Error", error, "error");
		}
	});
}
	$('#send_to_net{{.Unique}}').bind('click', sendnet{{.Unique}} );	
})

var phrase_limit = 20;

$(document).ready(function(){
    do_phrase(phrase_limit);
})
</script>

<div class="content-heading">
	Add New Citizen
</div>
<!-- START panel-->
<div class="panel panel-default" data-sweet-alert>
    <div class="panel-body">
        {{if .Message}}
        <div class="form-group">
            <label>{{.Message}}</label>
        </div>
        {{end}}
        <form role="form">
            <div class="form-group">
                <label for="name">Name</label>
                <input id="name" name="name" type="text" value="" class="form-control">
            </div>
            <div class="form-group">
                <label for="seed">Account seed</label>
				<textarea class="form-control" name="phrase" id="phrase" rows="5"></textarea>
				<div class="clearfix">
    				<button id="genseed" class="btn btn-default pull-left" type="button" onclick="return do_phrase(phrase_limit);">Generate new seed</button>
                </div>
                <input id="prvkey" type="hidden" value="">
                <input id="pubkey" type="hidden" value="">
            </div>
        </form>
    </div>
    <div class="panel-footer">
        <div class="clearfix">
            <div class="pull-right">
                <button type="button" class="btn btn-primary" id="send{{.Unique}}"  data-tool="panel-refresh" onClick="preloader(this);">Create new citizen</button>
            </div>
        </div>
    </div>
</div>
<!-- END panel-->
{{template "signatures".}}