{{ define "newTable" }}
	<style>
		th {
			cursor:move;
		}
	</style>
	
	<script>
		var serverTime;

		$(".aside .nav li").removeClass("active");
		$(".citizen, .citizen_listOfTables").addClass("active");

		var column = [];
		var columns = [];
		var columns_json = "";
		var table = $("#table tbody");
		
		function NewColumn() {
			var col = '<tr>' +
						 '<td><input class="colname form-control" type="text" value=""></td>' +
						 '<td>' +
						 	'<select class="column_type form-control" onChange="CheckIndex();"><option value="text">Text</option><option value="int64">Numbers</option><option value="time">Date/Time</option><option value="hash">Varchar(32)</option><option value="money">Money</option><option value="double">Double</option></select>' +
						 '</td>' +
						 '<td align="center">' +
								'<div class="checkbox c-checkbox" style="display:inline-block; width:auto;">' +
									'<label style="padding-left:0px;">' +
									   '<input class="hidden index" type="checkbox">' +
											'<span class="fa fa-check" style="margin:0px;"></span>' +
									   '</label>' +
								 '</div>' +
						'</td>' +
						 '<td><button type="button" class="btn btn-primary" onClick="RemoveColumn(this);">(-)</button></td>' +
					   '</tr>';
			table.append(col);
			$(".column_type").select2({
				minimumResultsForSearch: Infinity,
				theme: 'bootstrap'
			});
			$(".colname:last").focus();
			
			CheckIndex();
		}
		
		function RemoveColumn(elem) {
			$(elem).parents("tr").remove();
		}
		
		NewColumn();
		
		function CheckIndex() {
			$(".column_type").each(function() {
				var id = $(this);
				var val = id.val();
				if (val === "text") {
					id.parent().parent().find(".index").prop("disabled", true);
				} else {
					id.parent().parent().find(".index").prop("disabled", false);
				}
			});
		}
		
		$('#send').bind('click', function () {

			/*columns = [];
			$(".colname").each(function() {
				var val = $(this).val();
				columns.push(val);
			});*/
			columns = [];
			$("#table tr").each(function() {
				column = [];
				var val = $(this).find(".colname").val();
				var type = $(this).find(".column_type").val();
				var index =  (+ $(this).find(".index").prop("checked")).toString();
				column.push(val);
				column.push(type);
				column.push(index);
				columns.push(column);
			});
			columns.splice(0, 1);
			columns_json = JSON.stringify(columns)

			$.get( 'ajax?controllerName=GetServerTime', function (data) {
				serverTime = data.time;
				$("#for-signature").val('{{.TxTypeId}},'+serverTime+',{{.CitizenId}},{{.StateId}},'+$("#global").val()+','+$("#tableName").val()+','+columns_json);
			doSign();
			$("#send_to_net").trigger("click");
		}, "json" );
		} );


		$('#send_to_net').bind('click', function () {
			$.ajax({
				type: 'POST',
				url: 'ajax?controllerName=saveQueue',
				data: {
					'global' : $("#global").val(),
					'table_name' : $("#tableName").val(),
					'columns' : columns_json,
					'type' : '{{.TxType}}',
					'time' : serverTime,
					'citizenId' : '{{.CitizenId}}',
					'stateId' : '{{.StateId}}',
					'signature1': $('#signature1').val(),
					'signature2': $('#signature2').val(),
					'signature3': $('#signature3').val()
				},
				dataType: 'json',
				crossDomain: true,
				success: function(data) { send_to_net_success(data) },
				error: function(xhr, status, error) {
					Alert("Error", error, "error");
				}
			});
		} );
	</script>
	
	<div class="content-heading">
		New Table
	</div>
	<ol class="breadcrumb">
		<li><a href="#" onclick="load_page('listOfTables')">List Of Tables</a></li>
	</ol>
	<!-- START panel-->
	<div class="panel panel-default" data-sweet-alert>
		<div class="panel-heading">
			<div class="panel-title">
				<input id="tableName" class="form-control" type="text" value="" placeholder="Table name">
			</div>
		</div>
	 <div class="panel-body">
		 <div class="table-responsive">
		   <table id="table" class="table table-striped table-bordered table-hover">
			  <thead>
			  	<th>Column Name</th>
				<th width="150">Column Type</th>
				<th width="50">Index</th>
				<th width="50">Action</th>
			  </thead>
			  <tbody></tbody>
		   </table>
		</div>
	 </div>
	 <div class="panel-footer">
	   <div class="clearfix">
		  <div class="pull-left">
			 <button type="button" id="add" class="btn btn-primary" onClick="NewColumn();">Add column</button>
		  </div>
		  <div class="pull-right">
			 <button type="button" id="send" class="btn btn-primary" data-tool="panel-refresh" onClick="preloader(this);">Send</button>
		  </div>
	   </div>
	  </div>
	</div>

	<input id="global" type="hidden" value="{{.Global}}">

	<!-- END panel-->
	
	{{template "signatures".}}
	
{{end}}